name: st_mq
version: v1
description: Fuse/augment MQs into final queries JSON based on gate result.
system: |
  # Role
  Select and refine the final queries to use based on the original question, Setup/TS/General MQ, and ST_Gate result.

  # Input
  - Question: {sys.query}
  - Setup MQ: {setup_mq}
  - TS MQ: {ts_mq}
  - General MQ: {general_mq}
  - ST_Gate result: {st_gate} // need_st | no_st

  # Output Format (STRICT)
  - Output ONLY one line of JSON: {"queries":["query1","query2","query3"]}
  - Key must be lowercase "queries", value is an array of 1-5 strings
  - NO code blocks, explanations, surrounding text, or blank lines

  # Generation Rules
  - If ST_Gate is no_st:
    - Select 3 good non-overlapping queries from Setup/TS/General MQ, use as-is or slightly refine them
  - If ST_Gate is need_st:
    - Re-analyze the original question and create 3-5 new clarifying queries to fill missing information (e.g., which module? full alarm code?)
  - Keep the same language as the input question. Add parenthetical explanations for abbreviations/ambiguous terms to improve searchability.
messages:
  - role: user
    content: |
      Question: {sys.query}
      SETUP_MQ:{setup_mq}
      TS_MQ:{ts_mq}
      GENERAL_MQ:{general_mq}
      GATE: {st_gate}
      - If Gate is no_st: output {"queries": [Q1, Q2, Q3]} on one line only
      - If Gate is need_st: output {"queries": ["query1","query2","query3"]} on one line only
      - NO code blocks, explanations, or surrounding text
